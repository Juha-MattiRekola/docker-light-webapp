<!DOCTYPE html>
<html lang="fi" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arkkitehtuuri</title>
    <link rel="stylesheet" href="css/style.css">
    <style>
        /* Arkkitehtuuri-sivun omat tyylit */
        .arch-diagram {
            background: var(--bg-dark);
            border: 1px solid var(--border);
            border-radius: 6px;
            padding: 25px;
            font-size: 14px;
            overflow-x: auto;
            white-space: pre;
            line-height: 1.4;
            transition: background 0.3s, border-color 0.3s;
        }
        
        .flow-section {
            margin: 30px 0;
        }
        
        .flow-step {
            display: flex;
            gap: 15px;
            padding: 15px 0;
            border-bottom: 1px solid var(--border);
        }
        
        .flow-step:last-child { border-bottom: none; }
        
        .flow-num {
            width: 28px;
            height: 28px;
            background: var(--accent);
            color: var(--bg-dark);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 15px;
            font-weight: 600;
            flex-shrink: 0;
        }
        
        .flow-content h4 {
            color: var(--text);
            font-weight: 400;
            margin-bottom: 5px;
            font-size: 18px;
        }
        
        .flow-content h4::before { content: none; }
        
        .flow-content p {
            color: var(--text-dim);
            font-size: 16px;
            margin: 0;
        }
        
        .tech-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 12px;
            margin: 20px 0;
        }
        
        .tech-item {
            background: var(--bg-dark);
            border: 1px solid var(--border);
            border-radius: 6px;
            padding: 15px;
            text-align: center;
            transition: border-color 0.2s, background 0.3s;
        }
        
        .tech-item:hover { border-color: var(--accent); }
        
        .tech-name {
            color: var(--accent);
            font-size: 17px;
            margin-bottom: 5px;
        }
        
        .tech-role {
            color: var(--text-dim);
            font-size: 15px;
        }
    </style>
</head>
<body>
    <div class="container container-wide">
        <div class="terminal-header">
            <div class="terminal-dot dot-red"></div>
            <div class="terminal-dot dot-yellow"></div>
            <div class="terminal-dot dot-green"></div>
            <span class="terminal-title">arkkitehtuuri ~ terminaali</span>
            <button class="theme-toggle" onclick="toggleTheme()">teema</button>
        </div>
        
        <div class="terminal-body">
            <a href="index.html" class="back-link">takaisin</a>
            
            <h1>Järjestelmäarkkitehtuuri</h1>
            <p class="subtitle" style="white-space: pre-line;">Mikropalveluiden rakenne ja vuorovaikutus on kevyesti selvennettynä tällä sivulla.

                <b>KOKONAISARKKITEHTUURI</b> pyrkii kuvaamaan tämän kevyen esimerkkisovelluksen rakenteen kaavion avulla.

                <b>TEKNOLOGIAT</b> osiossa on listattu käytetyt työkalut ja niiden roolit järjestelmässä.

                <b>PYYNTÖJEN KULKU</b> osiossa käydään läpi, miten käyttäjän tekemä pyyntö etenee järjestelmässä.
            </p>
            
            <h2 class="section-title">Kokonaisarkkitehtuuri</h2>
            
            <div class="arch-diagram">
┌──────────────────────────────────────────────────────────────────────────────┐
│  <span style="color: var(--accent);">INTERNET</span>                                                                    │
│      │                                                                       │
│      ▼                                                                       │
│  ┌────────────────────────────────────────────────────────────────────────┐  │
│  │  <span style="color: var(--accent);">Cloudflare Tunnel</span>                                                     │  │
│  │  Julkinen pääsy ilman porttien avaamista                               │  │
│  └────────────────────────────────────────────────────────────────────────┘  │
│      │                                                                       │
│      ▼                                                                       │
│  ┌────────────────────────────────────────────────────────────────────────┐  │
│  │  <span style="color: var(--accent);">NGINX</span> (Reverse Proxy)                                        :80      │  │
│  │  ├── /            → Static HTML                                        │  │
│  │  ├── /api/*       → Flask API                                          │  │
│  │  ├── /adminer     → Adminer                                            │  │
│  │  ├── /prometheus  → Prometheus                                         │  │
│  │  └── /grafana     → Grafana                                            │  │
│  └────────────────────────────────────────────────────────────────────────┘  │
│      │                                                                       │
│      ├──────────────────┬──────────────────┬──────────────────┐              │
│      ▼                  ▼                  ▼                  ▼              │
│  ┌────────────┐   ┌────────────┐   ┌────────────┐   ┌────────────┐           │
│  │ <span style="color: var(--accent);">Flask API</span>  │   │ <span style="color: var(--accent);">Adminer</span>    │   │ <span style="color: var(--accent);">Prometheus</span> │   │ <span style="color: var(--accent);">Grafana</span>    │           │
│  │ :5000      │   │ :8080      │   │ :9090      │   │ :3000      │           │
│  │ REST API   │   │DB Hallinta │   │ Metriikat  │   │ Dashboardit│           │
│  └────────────┘   └────────────┘   └────────────┘   └────────────┘           │
│      │                  │                  ▲              │                  │
│      │                  │                  │ scrape       │                  │
│      ├──────────────────┤                  │              │                  │
│      ▼                  ▼                  │              ▼                  │
│  ┌────────────┐   ┌────────────┐           │        ┌────────────┐           │
│  │ <span style="color: var(--accent);">PostgreSQL</span> │   │ <span style="color: var(--accent);">Redis</span>      │    ───────┘        │ Prometheus │           │
│  │ :5432      │   │ :6379      │   (API:sta)        │(datalähde) │           │
│  │ Pysyvä data│   │ Välimuisti │                    └────────────┘           │
│  └────────────┘   └────────────┘                                             │
└──────────────────────────────────────────────────────────────────────────────┘</div>
            
            <h2 class="section-title">Teknologiat</h2>
            
            <div class="tech-grid">
                <div class="tech-item">
                    <div class="tech-name">NGINX</div>
                    <div class="tech-role">Välityspalvelin, staattisten sivujen palvelin</div>
                </div>
                <div class="tech-item">
                    <div class="tech-name">Flask</div>
                    <div class="tech-role">REST API, sovelluslogiikka web-sovelluskehyksen avulla</div>
                </div>
                <div class="tech-item">
                    <div class="tech-name">PostgreSQL</div>
                    <div class="tech-role">Tietokanta, yhdistetty volyymiin pysyvyyden takaamiseksi</div>
                </div>
                <div class="tech-item">
                    <div class="tech-name">Redis</div>
                    <div class="tech-role">Välimuisti nopeuttamaan sivustoa</div>
                </div>
                <div class="tech-item">
                    <div class="tech-name">Prometheus</div>
                    <div class="tech-role">Metriikoiden keruu, suorituskyvyn seuranta</div>
                </div>
                <div class="tech-item">
                    <div class="tech-name">Grafana</div>
                    <div class="tech-role">Prometheuksen keräämien metriikoiden visualisointi</div>
                </div>
                <div class="tech-item">
                    <div class="tech-name">Adminer</div>
                    <div class="tech-role">Tietokannan graafinen hallinta</div>
                </div>
                <div class="tech-item">
                    <div class="tech-name">Cloudflared</div>
                    <div class="tech-role">Tunneli julkiseen verkkoon</div>
                </div>
            </div>
            
            <h2 class="section-title">Pyyntöjen kulku</h2>
            
            <div class="flow-section">
                <div class="flow-step">
                    <div class="flow-num">1</div>
                    <div class="flow-content">
                        <h4>Käyttäjä tekee pyynnön</h4>
                        <p>Selain lähettää HTTP-pyynnön julkiseen URL:iin tai paikallisesti suuntaan localhost:80</p>
                    </div>
                </div>
                <div class="flow-step">
                    <div class="flow-num">2</div>
                    <div class="flow-content">
                        <h4>Cloudflare tunneli välittää</h4>
                        <p>Julkiset pyynnöt reititetään turvallisesti ilman avoimia portteja</p>
                    </div>
                </div>
                <div class="flow-step">
                    <div class="flow-num">3</div>
                    <div class="flow-content">
                        <h4>NGINX reitittää pyynnön</h4>
                        <p>Välityspalvelin ohjaa oikealle palvelulle polun perusteella</p>
                    </div>
                </div>
                <div class="flow-step">
                    <div class="flow-num">4</div>
                    <div class="flow-content">
                        <h4>API käsittelee</h4>
                        <p>Flask-sovellus tarkistaa Redis-välimuistin ja tekee tietokantakyselyt</p>
                    </div>
                </div>
                <div class="flow-step">
                    <div class="flow-num">5</div>
                    <div class="flow-content">
                        <h4>Vastaus palautetaan</h4>
                        <p>JSON-data kulkee takaisin samaa reittiä käyttäjälle</p>
                    </div>
                </div>
            </div>
            
            <div class="info-box" style="white-space: pre-line;">
                <strong>Miksi mikropalvelut?</strong> Jokainen palvelu voidaan skaalata, päivittää 
                ja kehittää itsenäisesti. Vikatilanteessa vain yksi osa järjestelmästä kaatuu.
                
                Kontit ovat pieniä ja rajattuja kokonaisuuksia.
                Tästä johtuen niistä on myös helpompaa löytää mahdollisia vikoja ja pullonkauloja.
                Lisäksi kontit ovat kevyitä ja nopeita käynnistää, ne ovat helposti siirrettävissä
                eri ympäristöjen välillä.
                
                Pilvipalvelutkin tukevat kontteja laajasti.
            </div>
        </div>
    </div>
    <script src="js/theme.js"></script>
</body>
</html>
